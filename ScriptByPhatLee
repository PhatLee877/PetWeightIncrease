-- Script By PhatLee - Pet Weight Control GUI (Only change [KG], keep everything else; Auto-resize GUI)
local Players = game:GetService("Players")
local TextService = game:GetService("TextService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- DANH SÁCH KEYWORD PET HỢP LỆ
local validKeywords = {
    "mimic octupus", "dragonfly", "raccoon", "disco",
    "french", "lobster", "kitsune", "t%-rex",
    "spinosaurus", "butterfly", "queen"
}

-- GUI chính
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "PetWeightGUI"
screenGui.ResetOnSpawn = false

-- Frame chính
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 260, 0, 170)
frame.Position = UDim2.new(0.5, -130, 0.5, -85)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

-- Title
local title = Instance.new("TextLabel", frame)
title.Text = "Pet Weight Controller"
title.Font = Enum.Font.FredokaOne
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1, 0, 0, 28)
title.Position = UDim2.new(0, 0, 0, 4)

-- Close Button
local closeButton = Instance.new("TextButton", frame)
closeButton.Text = "X"
closeButton.Font = Enum.Font.FredokaOne
closeButton.TextSize = 18
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
closeButton.Size = UDim2.new(0, 28, 0, 28)
closeButton.Position = UDim2.new(1, -34, 0, 4)
Instance.new("UICorner", closeButton)
closeButton.MouseButton1Click:Connect(function() frame.Visible = false end)

-- Pet info label
local petInfo = Instance.new("TextLabel", frame)
petInfo.Text = "Equipped Pet: [None]"
petInfo.Font = Enum.Font.FredokaOne
petInfo.TextSize = 16
petInfo.TextColor3 = Color3.fromRGB(255, 255, 160)
petInfo.BackgroundTransparency = 1
petInfo.Position = UDim2.new(0, 12, 0, 36)
petInfo.Size = UDim2.new(1, -24, 0, 20)
petInfo.TextXAlignment = Enum.TextXAlignment.Left
petInfo.TextWrapped = false

-- Auto-resize GUI theo độ dài petInfo
local function autoResizeGUI()
	local textSize = TextService:GetTextSize(
		petInfo.Text,
		petInfo.TextSize,
		petInfo.Font,
		Vector2.new(math.huge, petInfo.AbsoluteSize.Y)
	)
	local padding = 40
	local targetWidth = math.max(260, math.min(500, textSize.X + padding))
	local tween = TweenService:Create(
		frame,
		TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
		{
			Size = UDim2.new(0, targetWidth, 0, frame.Size.Y.Offset)
		}
	)
	tween:Play()
end

-- Hàm lấy pet
local function getEquippedPetTool()
	character = player.Character or player.CharacterAdded:Wait()
	for _, child in pairs(character:GetChildren()) do
		if child:IsA("Tool") and child.Name:find("KG") then
			return child
		end
	end
end

-- Lấy giá trị KG từ tên
local function parsePetName(name)
	return tonumber(name:match("%[%s*(%d+%.?%d*)%s*KG%s*%]"))
end

-- Thay đúng ô [x KG], giữ nguyên Age
local function setPetKGInPlace(tool, newKG)
	local name = tool.Name
	local newKGText = string.format("[%.2f KG]", newKG)
	local replaced, count = name:gsub("%[%s*%d+%.?%d*%s*KG%s*%]", newKGText, 1)
	if count == 0 then
		replaced = name .. " " .. newKGText
	end
	tool.Name = replaced
end

-- GUI cảnh báo chung
local function createCenterNotice(text, time, allowClose)
	local f = Instance.new("Frame", screenGui)
	f.Size = UDim2.new(0, 460, 0, 90)
	f.Position = UDim2.new(0.5, -230, 0.35, 0)
	f.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	f.BackgroundTransparency = 0.3
	Instance.new("UICorner", f).CornerRadius = UDim.new(0, 12)

	local lbl = Instance.new("TextLabel", f)
	lbl.Size = UDim2.new(1, -60, 1, -10)
	lbl.Position = UDim2.new(0, 10, 0, 5)
	lbl.BackgroundTransparency = 1
	lbl.Font = Enum.Font.FredokaOne
	lbl.TextSize = 16
	lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
	lbl.TextWrapped = true

	local closeBtn
	if allowClose then
		closeBtn = Instance.new("TextButton", f)
		closeBtn.Text = "X"
		closeBtn.Font = Enum.Font.FredokaOne
		closeBtn.TextSize = 18
		closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
		closeBtn.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
		closeBtn.Size = UDim2.new(0, 30, 0, 30)
		closeBtn.Position = UDim2.new(1, -35, 0, 5)
		Instance.new("UICorner", closeBtn)
		closeBtn.MouseButton1Click:Connect(function() f:Destroy() end)
	end

	task.spawn(function()
		for t = time, 1, -1 do
			lbl.Text = text:gsub("{t}", tostring(t))
			task.wait(1)
		end
		if f then f:Destroy() end
	end)
	return f
end

-- Hiện GUI khi mới execute
task.spawn(function()
	createCenterNotice(
		"Please hold your pet after clicking the increase button. Also, you won't see that you're holding your pet, because I hide your pet to Jandel. (This will disappear in {t} seconds.)",
		10,
		false
	)
end)

-- Kiểm tra pet có hợp lệ không
local function isPetValid(name)
	local lowerName = name:lower()
	for _, keyword in ipairs(validKeywords) do
		if lowerName:find(keyword) then
			return true
		end
	end
	return false
end

-- Trạng thái tăng
local isIncreasing = false
local originalTool, originalKG

-- Hàm tăng cân
local function increaseWeight(multiplier, add)
	local tool = getEquippedPetTool()
	if not tool then
		petInfo.Text = "No Pet Equipped!"
		autoResizeGUI()
		return
	end

	-- Kiểm tra keyword
	if not isPetValid(tool.Name) then
		createCenterNotice("This only works with good pets, please use an account with good pet.", 6, true)
		return
	end

	local currentKG = parsePetName(tool.Name)
	if not currentKG then
		petInfo.Text = "Invalid Pet Format!"
		autoResizeGUI()
		return
	end

	if currentKG > 60 then
		createCenterNotice("Pet weight growth too fast will make your account get banned.", 5, true)
		return
	end

	local targetKG = multiplier and currentKG * multiplier or currentKG + add
	if targetKG > 60 then
		createCenterNotice("Pet weight growth too fast will make your account get banned.", 5, true)
		return
	end

	isIncreasing = true
	originalTool = tool
	originalKG = currentKG

	for t = 25, 1, -1 do
		local holding = getEquippedPetTool()
		if not holding or holding ~= originalTool then
			setPetKGInPlace(originalTool, originalKG)
			createCenterNotice("Please don't change your pet while weight increasing.", 5, true)
			isIncreasing = false
			return
		end
		local progress = (25 - t + 1) / 25
		local interim = currentKG + (targetKG - currentKG) * progress
		setPetKGInPlace(originalTool, interim)
		petInfo.Text = "Pet weight is increasing in " .. t .. "s"
		autoResizeGUI()
		task.wait(1)
	end

	setPetKGInPlace(originalTool, targetKG)
	petInfo.Text = "Equipped Pet: " .. originalTool.Name
	autoResizeGUI()
	isIncreasing = false
end

-- Nút x2
local btnX2 = Instance.new("TextButton", frame)
btnX2.Text = "Increase Pet Weight by x2"
btnX2.Font = Enum.Font.FredokaOne
btnX2.TextSize = 16
btnX2.TextColor3 = Color3.fromRGB(40, 40, 40)
btnX2.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
btnX2.Size = UDim2.new(0, 230, 0, 34)
btnX2.Position = UDim2.new(0.5, -115, 0, 70)
Instance.new("UICorner", btnX2)
btnX2.MouseButton1Click:Connect(function()
	increaseWeight(2, nil)
end)

-- Nút +1kg
local btnAdd1 = Instance.new("TextButton", frame)
btnAdd1.Text = "Increase Pet Weight by 1KG"
btnAdd1.Font = Enum.Font.FredokaOne
btnAdd1.TextSize = 16
btnAdd1.TextColor3 = Color3.fromRGB(40, 40, 40)
btnAdd1.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
btnAdd1.Size = UDim2.new(0, 230, 0, 34)
btnAdd1.Position = UDim2.new(0.5, -115, 0, 114)
Instance.new("UICorner", btnAdd1)
btnAdd1.MouseButton1Click:Connect(function()
	increaseWeight(nil, 1)
end)

-- Footer
local footer = Instance.new("TextLabel", frame)
footer.Text = "-- Script By PhatLee --"
footer.Font = Enum.Font.FredokaOne
footer.TextSize = 13
footer.TextColor3 = Color3.fromRGB(180, 180, 180)
footer.BackgroundTransparency = 1
footer.Size = UDim2.new(1, 0, 0, 18)
footer.Position = UDim2.new(0, 0, 1, -24)

-- Auto refresh pet info
task.spawn(function()
	while true do
		if not isIncreasing then
			local pet = getEquippedPetTool()
			if pet then
				petInfo.Text = "Equipped Pet: " .. pet.Name
			else
				petInfo.Text = "Equipped Pet: [None]"
			end
			autoResizeGUI()
		end
		task.wait(1)
	end
end)
